<div class="page-container page-fade-in">
  
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner-border text-gold" role="status"></div>
    <p>Loading Profile...</p>
  </div>

  <div *ngIf="!isLoading && profile" class="profile-layout">
    
    <div class="profile-sidebar">
      <div class="user-card">
        <div class="avatar-container">
          <img [src]="imagePreview || (profile.avatarUrl ? environment.apiBaseUrl2 + '/avatars/' + profile.avatarUrl : '')" 
               class="avatar-img" 
               *ngIf="profile.avatarUrl || imagePreview">
          
          <div *ngIf="!profile.avatarUrl && !imagePreview" class="avatar-placeholder">
            {{ getInitials(profile.firstName, profile.lastName) }}
          </div>

          <label *ngIf="isEditMode" class="edit-avatar-btn">
            <i class="bi bi-camera-fill"></i>
            <input type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
          </label>
        </div>

        <h2 class="user-name">{{ profile.firstName }} {{ profile.lastName }}</h2>
        <p class="user-role">{{ profile.role }}</p>
        
        <div class="divider"></div>

        <div class="security-section">
          <div class="sec-info">
            <span class="label">Two-Factor Auth</span>
            <span class="status" [class.on]="profile.twoFactorEnabled">
              {{ profile.twoFactorEnabled ? 'Enabled' : 'Disabled' }}
            </span>
          </div>
          <button class="btn-toggle-2fa" 
                  [class.active]="profile.twoFactorEnabled" 
                  (click)="toggle2FA()">
            <i class="bi" [class.bi-shield-check]="profile.twoFactorEnabled" [class.bi-shield-x]="!profile.twoFactorEnabled"></i>
            {{ profile.twoFactorEnabled ? 'Disable' : 'Enable' }}
          </button>
        </div>
      </div>
    </div>

    <div class="profile-content">
      <div class="content-header">
        <h3>Personal Information</h3>
        <button class="btn-edit" (click)="toggleEditMode()" *ngIf="!isEditMode">
          <i class="bi bi-pencil-square"></i> Edit Profile
        </button>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="saveChanges()">
        
        <div class="form-section">
          <label>Bio</label>
          <br>
            <textarea 
                [readonly]="!isEditMode" 
                formControlName="bio" 
                placeholder="Tell us about yourself..."
                class="bio-input">
            </textarea>   
             </div>

        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input [readonly]="!isEditMode" formControlName="firstName" type="text">
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input [readonly]="!isEditMode" formControlName="lastName" type="text">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Email (Read Only)</label>
            <input readonly [value]="profile.email" type="email" class="readonly-field">
          </div>
          <div class="form-group">
            <label>Phone Number</label>
            <input [readonly]="!isEditMode" formControlName="phoneNumber" type="tel" placeholder="+1 234 567 890">
          </div>
        </div>

        <div class="form-group">
          <label>Website</label>
          <input [readonly]="!isEditMode" formControlName="websiteUrl" type="url" placeholder="https://yourwebsite.com">
        </div>

        <h4 class="mt-4 mb-3">Social Media</h4>
        <div class="form-row">
          <div class="form-group">
            <label><i class="bi bi-facebook text-primary"></i> Facebook</label>
            <input [readonly]="!isEditMode" formControlName="facebookUrl" type="text">
          </div>
          <div class="form-group">
            <label><i class="bi bi-twitter-x"></i> Twitter / X</label>
            <input [readonly]="!isEditMode" formControlName="twitterUrl" type="text">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label><i class="bi bi-instagram text-danger"></i> Instagram</label>
            <input [readonly]="!isEditMode" formControlName="instagramUrl" type="text">
          </div>
          <div class="form-group">
            <label><i class="bi bi-linkedin text-info"></i> LinkedIn</label>
            <input [readonly]="!isEditMode" formControlName="linkedInUrl" type="text">
          </div>
        </div>

        <div class="form-actions" *ngIf="isEditMode">
          <button type="button" class="btn-cancel" (click)="toggleEditMode()">Cancel</button>
          <button type="submit" class="btn-save" [disabled]="isSaving">
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>

      </form>
    </div>

  </div>
</div>